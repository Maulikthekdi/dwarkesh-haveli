<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Annkut Pavti Entry</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family: system-ui, Arial, sans-serif;
  background:#f4f6f8;
  margin:0;
  padding:12px;
}

h2{
  margin-bottom:8px;
}

label{
  font-weight:600;
}

input, select{
  padding:6px;
  border:1px solid #ccc;
  border-radius:4px;
  width:100%;
}

button{
  padding:8px 14px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:600;
}

.add-btn{
  background:#2563eb;
  color:#fff;
}

.del-btn{
  background:#dc2626;
  color:#fff;
}

.print-btn{
  background:#16a34a;
  color:#fff;
  margin-top:10px;
}

table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  margin-top:10px;
  font-size:14px;
}

thead{
  background:#e5e7eb;
  position:sticky;
  top:0;
}

th, td{
  border:1px solid #d1d5db;
  padding:6px;
  text-align:center;
}

.cancelled{
  background:#fee2e2;
  text-decoration:line-through;
}

.summary{
  background:#eef2ff;
  padding:12px;
  border-radius:8px;
  margin-top:14px;
}

.summary p{
  margin:4px 0;
}

@media(max-width:768px){
  th, td{font-size:12px;}
}
</style>
</head>

<body>

<h2>üõï Annkut Pavti Entry</h2>

<label>Starting Pavti No:</label>
<input type="number" id="startNo" value="1">

<table id="entryTable">
<thead>
<tr>
  <th>Pavti No</th>
  <th>Prakar</th>
  <th>Rakam</th>
  <th>Cash Mode</th>
  <th>Cancelled</th>
  <th>Delete</th>
</tr>
</thead>
<tbody></tbody>
</table>

<button class="add-btn" onclick="addRow()">‚ûï Add Entry</button>

<div class="summary" id="summary">
<h3>üìä Final Summary</h3>
<div id="roundedCounts"></div>
<hr>
<p><b>Total Cash:</b> ‚Çπ<span id="totalCash">0</span></p>
<p><b>Samagri Count:</b> <span id="samCount">0</span></p>
<p><b>Samagri Amount:</b> ‚Çπ<span id="samAmount">0</span></p>
<p><b>Online Amount:</b> ‚Çπ<span id="onlineAmt">0</span></p>
<p><b>Online Entries:</b> <span id="onlineCnt">0</span></p>
</div>

<button class="print-btn" onclick="printSummary()">üñ®Ô∏è Print Summary</button>

<script>
let currentNo = 0;

function addRow(){
  let start = Number(document.getElementById("startNo").value || 1);
  if(currentNo === 0) currentNo = start;

  const tbody = document.querySelector("#entryTable tbody");
  const row = tbody.insertRow();

  row.innerHTML = `
  <td><input type="number" value="${currentNo}"></td>
  <td>
    <select onchange="calc()">
      <option></option>
      <option>Cash</option>
      <option>Samagri</option>
    </select>
  </td>
  <td><input type="number" oninput="calc()"></td>
  <td>
    <select onchange="calc()">
      <option></option>
      <option>Rokda</option>
      <option>Online</option>
    </select>
  </td>
  <td><input type="checkbox" onchange="toggleCancel(this)"></td>
  <td><button class="del-btn" onclick="deleteRow(this)">‚ùå</button></td>
  `;

  currentNo++;
}

function deleteRow(btn){
  btn.closest("tr").remove();
  calc();
}

function toggleCancel(cb){
  const row = cb.closest("tr");
  row.classList.toggle("cancelled", cb.checked);
  calc();
}

function round100(v){
  return Math.round(v/100)*100;
}

function calc(){
  let rows = document.querySelectorAll("#entryTable tbody tr");
  let totalCash=0, samCount=0, samAmount=0, onlineAmt=0, onlineCnt=0;
  let map={};

  rows.forEach(r=>{
    if(r.querySelector('input[type="checkbox"]').checked) return;

    let pr = r.cells[1].children[0].value;
    let amt = Number(r.cells[2].children[0].value || 0);
    let mode = r.cells[3].children[0].value;

    if(pr==="Cash" && amt>0){
      totalCash+=amt;
      let k=round100(amt);
      map[k]=(map[k]||0)+1;
      if(mode==="Online"){
        onlineAmt+=amt;
        onlineCnt++;
      }
    }

    if(pr==="Samagri" && amt>0){
      samCount++;
      samAmount+=amt;
    }
  });

  let html="";
  Object.keys(map).sort((a,b)=>a-b).forEach(k=>{
    html+=`<p>‚Çπ${k} Count: <b>${map[k]}</b></p>`;
  });
  document.getElementById("roundedCounts").innerHTML = html;

  totalCash.textContent = totalCash;
  samCountSpan.textContent = samCount;
  samAmountSpan.textContent = samAmount;
  onlineAmtSpan.textContent = onlineAmt;
  onlineCntSpan.textContent = onlineCnt;
}

const totalCash = document.getElementById("totalCash");
const samCountSpan = document.getElementById("samCount");
const samAmountSpan = document.getElementById("samAmount");
const onlineAmtSpan = document.getElementById("onlineAmt");
const onlineCntSpan = document.getElementById("onlineCnt");

function printSummary(){
  let w = window.open("");
  w.document.write("<h2>Annkut Final Summary</h2>");
  w.document.write(document.getElementById("summary").innerHTML);
  w.print();
  w.close();
}
</script>

</body>
</html>
